{% extends 'base.html.twig' %}

{% block title %}Catalogue des Documents{% endblock %}

{% block body %} 
<div class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">

    <!-- En-tête de la page -->
    <header class="mb-8 flex items-center justify-between">
        <h1 class="text-4xl font-extrabold text-white tracking-tight flex items-center">
            <i data-lucide="book-open-text" class="w-8 h-8 mr-3 text-primary"></i>
            Catalogue des Documents
        </h1>
        <div class="hidden sm:block">
             <p class="text-gray-400 mt-2">Cliquez sur le titre ou la ligne pour consulter le document.</p>
        </div>
    </header>

    <!-- Barres d'action : Accès au Suivi et Upload -->
    <div class="mb-8 flex flex-col sm:flex-row justify-end space-y-4 sm:space-y-0 sm:space-x-4">
        
        {# BOUTON NOUVEAU : Accès au Suivi des Documents (pour les admins) #}
        {# Idéalement, à envelopper d'une vérification d'accès: {% if is_granted('ROLE_ADMIN') %} #}
        <a href="{{ path('admin_dashboard') }}" class="inline-flex items-center px-4 py-2 border border-gray-600 text-sm font-medium rounded-xl shadow-lg text-gray-300 bg-gray-700/50 hover:bg-gray-700 transition duration-200 transform hover:scale-[1.02] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 focus:ring-offset-body-bg justify-center">
            <i data-lucide="bar-chart-3" class="w-4 h-4 mr-2"></i>
            Suivi des Documents
        </a>

        {# BOUTON UPLOAD (Admin) #}
        <a href="{{ path('app_admin_document_new') }}" class="inline-flex items-center px-6 py-3 border border-transparent text-sm font-medium rounded-xl shadow-lg text-white bg-primary hover:bg-primary-dark transition duration-200 transform hover:scale-[1.02] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary focus:ring-offset-body-bg justify-center">
            <i data-lucide="upload-cloud" class="w-5 h-5 mr-2"></i>
            Uploader un nouveau document
        </a>
    </div>

    <!-- Tableau de Documents -->
    <div class="bg-card-bg shadow-2xl overflow-hidden rounded-xl border border-gray-700/50">
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-700">
                <thead class="bg-gray-800/70">
                    <tr>
                        <th scope="col" class="px-6 py-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">
                            Titre du Document
                        </th>
                        <th scope="col" class="px-6 py-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider hidden sm:table-cell">
                            Référence
                        </th>
                        <th scope="col" class="px-6 py-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider hidden md:table-cell">
                            Créé le
                        </th>
                        <th scope="col" class="relative px-6 py-4">
                            <span class="sr-only">Action</span>
                        </th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-700">
                    {% for document in documents %}
                        {# Rendre la ligne entière cliquable avec effet visuel #}
                        <tr class="bg-card-bg hover:bg-gray-700 transition duration-150 ease-in-out cursor-pointer" 
                            onclick="window.location='{{ path('app_admin_document_show', {'id': document.id}) }}';">
                            
                            {# Titre du Document #}
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                <a href="{{ path('app_admin_document_show', {'id': document.id}) }}" class="text-primary hover:text-indigo-400 transition duration-150 font-bold">
                                    {{ document.title }}
                                </a>
                            </td>

                            {# Référence #}
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400 hidden sm:table-cell">
                                {{ document.reference }}
                            </td>

                            {# Date de Création #}
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400 hidden md:table-cell">
                                {{ document.createdAt|date('Y-m-d H:i') }}
                            </td>
                            
                            {# Colonne d'Action (bouton de lecture) #}
                            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                <a href="{{ path('app_admin_document_show', {'id': document.id}) }}" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-full text-white bg-primary hover:bg-primary-dark transition duration-150 shadow-md">
                                    <i data-lucide="file-text" class="w-4 h-4 mr-1"></i>
                                    Lire
                                </a>
                            </td>
                        </tr>
                    {% else %}
                        <tr>
                            <td colspan="4" class="p-8 text-center text-gray-400">
                                <i data-lucide="folder-x" class="w-10 h-10 mx-auto mb-3 text-gray-500"></i>
                                <p>Aucun document n'a été trouvé.</p>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

{# Nécessaire pour initialiser les icônes Lucide #}
<script>
    if (typeof lucide !== 'undefined') {
        lucide.createIcons();
    }
</script>


{% endblock %}